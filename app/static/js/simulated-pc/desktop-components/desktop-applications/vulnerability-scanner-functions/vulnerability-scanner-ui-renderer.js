/**
 * UI Renderer Module for Vulnerability Scanner
 * Handles HTML generation and DOM manipulation
 */
export class VulnerabilityScannerUIRenderer {
    constructor() {
        this.elements = {};
    }

    createMainHTML() {
        return `
            <!-- Skip Navigation Links for WCAG 2.1 AAA Compliance -->
            <nav class="sr-only" aria-label="Skip navigation">
                <a href="#main-content" class="skip-link absolute top-0 left-0 bg-blue-600 text-white px-4 py-2 z-50 focus:not-sr-only focus:relative">Skip to main content</a>
                <a href="#target-selection" class="skip-link absolute top-0 left-0 bg-blue-600 text-white px-4 py-2 z-50 focus:not-sr-only focus:relative">Skip to target selection</a>
                <a href="#scan-results" class="skip-link absolute top-0 left-0 bg-blue-600 text-white px-4 py-2 z-50 focus:not-sr-only focus:relative">Skip to scan results</a>
            </nav>
            
            <div class="h-full bg-black text-white overflow-hidden flex flex-col" role="application" aria-label="Vulnerability Scanner Application">
                <!-- Live Regions for Screen Readers -->
                <div id="announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>
                <div id="alerts" class="sr-only" aria-live="assertive" aria-atomic="true"></div>
                
                <!-- Header -->
                <header class="bg-gray-800 border-b border-gray-600 p-4 flex-shrink-0" role="banner">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-red-600 rounded flex items-center justify-center" role="img" aria-label="Security shield icon">
                                <i class="bi bi-shield-exclamation text-white text-sm" aria-hidden="true"></i>
                            </div>
                            <div>
                                <h1 class="text-lg font-semibold text-white">CyberQuest Vulnerability Scanner</h1>
                                <p class="text-xs text-gray-300">OWASP ZAP Simulation - Web Application Security Testing</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="scan-status px-3 py-1 bg-gray-700 rounded text-xs font-mono" role="status" aria-label="Current scan status">
                                Status: <span id="scanStatusText" class="text-green-400" aria-live="polite">Ready</span>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Main Interface -->
                <section id="main-content" class="flex flex-1 overflow-hidden" role="main">
                    <!-- Left Panel - Targets & Configuration -->
                    <aside class="w-1/3 bg-gray-700 border-r border-gray-600 overflow-y-auto" role="complementary" aria-label="Scan Configuration Panel">
                        <div class="p-4">
                            <!-- Target Selection -->
                            <section id="target-selection" class="mb-6">
                                <h2 class="text-sm font-semibold text-gray-100 mb-3 flex items-center">
                                    <i class="bi bi-bullseye mr-2" aria-hidden="true"></i>
                                    Target Selection
                                </h2>
                                <div class="space-y-2">
                                    <label for="targetSelect" class="sr-only">Select a target for vulnerability scanning</label>
                                    <select 
                                        id="targetSelect" 
                                        class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-white text-sm focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-50 cursor-pointer"
                                        aria-describedby="target-select-help">
                                        <option value="">Select target...</option>
                                    </select>
                                    <div id="target-select-help" class="sr-only">Choose a predefined target from the dropdown or add a custom target below</div>
                                    
                                    <label for="targetUrlInput" class="sr-only">Enter custom target URL</label>
                                    <input 
                                        type="url" 
                                        id="targetUrlInput"
                                        placeholder="https://vote.municipality.gov"
                                        class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-white text-sm focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-50"
                                        aria-describedby="target-url-help"
                                    >
                                    <div id="target-url-help" class="sr-only">Enter a valid URL starting with http:// or https:// to add as a custom scan target</div>
                                    
                                    <button 
                                        id="addTargetBtn"
                                        class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 focus:bg-blue-700 text-white rounded text-sm transition-colors font-medium cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-50"
                                        aria-describedby="add-target-help">
                                        Add Custom Target
                                    </button>
                                    <div id="add-target-help" class="sr-only">Add the URL entered above as a new target for vulnerability scanning</div>
                                </div>
                            </section>

                            <!-- Scan Configuration -->
                            <section class="mb-6">
                                <h2 class="text-sm font-semibold text-gray-100 mb-3 flex items-center">
                                    <i class="bi bi-gear mr-2" aria-hidden="true"></i>
                                    Scan Configuration
                                </h2>
                                <div class="space-y-3">
                                    <!-- Scan Type Selection -->
                                    <div class="mb-3">
                                        <label for="scanTypeSelect" class="text-sm font-medium text-gray-100 mb-2 block">Scan Type:</label>
                                        <select 
                                            id="scanTypeSelect" 
                                            class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-white text-sm focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-50 cursor-pointer"
                                            aria-describedby="scan-type-help">
                                            <option value="comprehensive">Comprehensive Scan</option>
                                            <option value="quick">Quick Scan</option>
                                            <option value="custom">Custom Scan</option>
                                        </select>
                                        <div id="scan-type-help" class="text-xs text-gray-300 mt-1">Choose the depth and scope of the vulnerability scan</div>
                                    </div>
                                    
                                    <!-- Custom Scan Options -->
                                    <fieldset id="customScanOptions" class="scan-type-options hidden">
                                        <legend class="text-sm font-medium text-gray-100 mb-2">Select Tests:</legend>
                                        <div class="space-y-2">
                                            <label class="flex items-center text-sm text-gray-200 cursor-pointer hover:text-white transition-colors">
                                                <input type="checkbox" id="sqlInjectionCheck" class="mr-2 accent-blue-500 focus:ring-2 focus:ring-blue-400 focus:ring-opacity-50" checked aria-describedby="sql-injection-desc">
                                                SQL Injection Detection
                                            </label>
                                            <div id="sql-injection-desc" class="text-xs text-gray-400 ml-6">Tests for SQL injection vulnerabilities in forms and URL parameters</div>
                                            
                                            <label class="flex items-center text-sm text-gray-200 cursor-pointer hover:text-white transition-colors">
                                                <input type="checkbox" id="xssCheck" class="mr-2 accent-blue-500 focus:ring-2 focus:ring-blue-400 focus:ring-opacity-50" checked aria-describedby="xss-desc">
                                                Cross-Site Scripting (XSS)
                                            </label>
                                            <div id="xss-desc" class="text-xs text-gray-400 ml-6">Detects reflected and stored XSS vulnerabilities</div>
                                            
                                            <label class="flex items-center text-sm text-gray-200 cursor-pointer hover:text-white transition-colors">
                                                <input type="checkbox" id="directoryTraversalCheck" class="mr-2 accent-blue-500 focus:ring-2 focus:ring-blue-400 focus:ring-opacity-50" checked aria-describedby="directory-traversal-desc">
                                                Directory Traversal
                                            </label>
                                            <div id="directory-traversal-desc" class="text-xs text-gray-400 ml-6">Tests for path traversal vulnerabilities</div>
                                            
                                            <label class="flex items-center text-sm text-gray-200 cursor-pointer hover:text-white transition-colors">
                                                <input type="checkbox" id="authBypassCheck" class="mr-2 accent-blue-500 focus:ring-2 focus:ring-blue-400 focus:ring-opacity-50" checked aria-describedby="auth-bypass-desc">
                                                Authentication Bypass
                                            </label>
                                            <div id="auth-bypass-desc" class="text-xs text-gray-400 ml-6">Attempts to bypass authentication mechanisms</div>
                                            
                                            <label class="flex items-center text-sm text-gray-200 cursor-pointer hover:text-white transition-colors">
                                                <input type="checkbox" id="csrfCheck" class="mr-2 accent-blue-500 focus:ring-2 focus:ring-blue-400 focus:ring-opacity-50" aria-describedby="csrf-desc">
                                                CSRF Detection
                                            </label>
                                            <div id="csrf-desc" class="text-xs text-gray-400 ml-6">Tests for Cross-Site Request Forgery vulnerabilities</div>
                                        </div>
                                    </fieldset>
                                </div>
                            </section>

                            <!-- Scan Controls -->
                            <section aria-label="Scan Control Buttons">
                                <div class="space-y-2">
                                    <button 
                                        id="scanToggleBtn"
                                        class="w-full px-4 py-3 bg-red-600 hover:bg-red-700 focus:bg-red-700 text-white rounded font-semibold transition-all duration-200 cursor-pointer focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-50"
                                        data-state="ready"
                                        aria-describedby="scan-toggle-help">
                                        <i class="bi bi-play-fill mr-2" aria-hidden="true"></i>
                                        <span class="btn-text">Start Vulnerability Scan</span>
                                    </button>
                                    <div id="scan-toggle-help" class="sr-only">Start or stop the vulnerability scanning process. Keyboard shortcut: Ctrl+Enter</div>
                                    
                                    <button 
                                        id="exportResultsBtn"
                                        class="w-full px-4 py-2 bg-gray-600 hover:bg-gray-500 focus:bg-gray-500 text-white rounded text-sm transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50"
                                        disabled
                                        aria-describedby="export-help">
                                        <i class="bi bi-download mr-2" aria-hidden="true"></i>
                                        Export Results
                                    </button>
                                    <div id="export-help" class="sr-only">Export scan results to a JSON file. Available after completing a scan. Keyboard shortcut: Ctrl+E</div>
                                    
                                    <!-- Report Generation Section -->
                                    <div class="mt-4 pt-4 border-t border-gray-700">
                                        <h4 class="text-sm font-medium text-gray-300 mb-3">Generate Reports</h4>
                                        
                                        <button 
                                            id="generateHTMLReportBtn"
                                            class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-500 focus:bg-blue-500 text-white rounded text-sm transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-50 mb-2"
                                            disabled
                                            aria-describedby="html-report-help">
                                            <i class="bi bi-file-earmark-text mr-2" aria-hidden="true"></i>
                                            HTML Report
                                        </button>
                                        <div id="html-report-help" class="sr-only">Generate comprehensive HTML vulnerability report. Available after completing a scan. Keyboard shortcut: Ctrl+R</div>
                                        
                                        <button 
                                            id="generateCSVReportBtn"
                                            class="w-full px-4 py-2 bg-green-600 hover:bg-green-500 focus:bg-green-500 text-white rounded text-sm transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-50 mb-2"
                                            disabled
                                            aria-describedby="csv-report-help">
                                            <i class="bi bi-table mr-2" aria-hidden="true"></i>
                                            CSV Summary
                                        </button>
                                        <div id="csv-report-help" class="sr-only">Generate CSV summary of vulnerabilities. Available after completing a scan. Keyboard shortcut: Ctrl+C</div>
                                        
                                        <div class="flex space-x-2">
                                            <button 
                                                id="generateAllReportsBtn"
                                                class="flex-1 px-3 py-2 bg-purple-600 hover:bg-purple-500 focus:bg-purple-500 text-white rounded text-xs transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-purple-400 focus:ring-opacity-50"
                                                disabled
                                                aria-describedby="all-reports-help">
                                                <i class="bi bi-files mr-1" aria-hidden="true"></i>
                                                All Formats
                                            </button>
                                            
                                            <button 
                                                id="integrateNmapBtn"
                                                class="flex-1 px-3 py-2 bg-orange-600 hover:bg-orange-500 focus:bg-orange-500 text-white rounded text-xs transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-orange-400 focus:ring-opacity-50"
                                                aria-describedby="nmap-integration-help">
                                                <i class="bi bi-diagram-3 mr-1" aria-hidden="true"></i>
                                                Nmap Data
                                            </button>
                                        </div>
                                        <div id="all-reports-help" class="sr-only">Generate all report formats simultaneously. Available after completing a scan. Keyboard shortcut: Ctrl+Shift+R</div>
                                        <div id="nmap-integration-help" class="sr-only">Integrate network scan data from nmap command. Always available. Keyboard shortcut: Ctrl+N</div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </aside>
                                    <!-- Right Panel - Results & Details -->
                    <section class="flex-1 flex flex-col" role="region" aria-label="Scan Results and Details">
                        <!-- Progress Bar -->
                        <div id="progressContainer" class="bg-gray-800 border-b border-gray-600 p-4 hidden flex-shrink-0" role="status" aria-label="Scan Progress">
                            <div class="flex items-center justify-between mb-2">
                                <h2 class="text-sm font-semibold text-gray-100">Scan Progress</h2>
                                <span id="progressText" class="text-xs text-gray-300" aria-live="polite">0%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-2" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-describedby="progress-description">
                                <div id="progressBar" class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                            <div id="progress-description" class="sr-only">Vulnerability scan progress indicator</div>
                            <div id="currentTest" class="text-xs text-gray-400 mt-1" aria-live="polite"></div>
                        </div>

                        <!-- Statistics Panel -->
                        <div class="stats-panel bg-gray-800 px-4 py-2 border-b border-gray-600 flex-shrink-0" role="region" aria-label="Scan Statistics Summary">
                            <h2 class="sr-only">Vulnerability Scan Statistics</h2>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                <div class="stat-item" role="status" aria-label="Total targets available">
                                    <div id="totalTargets" class="text-lg font-bold text-blue-400" aria-live="polite">0</div>
                                    <div class="text-xs text-gray-300">Total Targets</div>
                                </div>
                                <div class="stat-item" role="status" aria-label="Targets with vulnerabilities">
                                    <div id="vulnerableTargets" class="text-lg font-bold text-red-400" aria-live="polite">0</div>
                                    <div class="text-xs text-gray-300">Vulnerable</div>
                                </div>
                                <div class="stat-item" role="status" aria-label="Total vulnerabilities found">
                                    <div id="totalVulns" class="text-lg font-bold text-yellow-400" aria-live="polite">0</div>
                                    <div class="text-xs text-gray-300">Vulnerabilities</div>
                                </div>
                                <div class="stat-item" role="status" aria-label="High and critical severity vulnerabilities">
                                    <div id="highSeverity" class="text-lg font-bold text-red-500" aria-live="polite">0</div>
                                    <div class="text-xs text-gray-300">High/Critical</div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab Navigation -->
                        <nav class="tab-navigation bg-gray-800 border-b border-gray-600 flex-shrink-0" role="tablist" aria-label="Scan Results Tabs">
                            <div class="flex">
                                <button 
                                    class="tab-btn active px-4 py-2 text-sm font-medium border-r border-gray-600 bg-blue-600 text-white cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-inset" 
                                    data-tab="vulnerabilities"
                                    role="tab"
                                    aria-selected="true"
                                    aria-controls="vulnerabilitiesTab"
                                    id="vulnerabilities-tab"
                                    aria-describedby="vulnerabilities-tab-help">
                                    Vulnerabilities <span id="vulnCount" class="ml-1 px-2 py-0.5 bg-gray-800 text-white text-xs rounded" aria-label="vulnerabilities count">0</span>
                                </button>
                                <div id="vulnerabilities-tab-help" class="sr-only">View discovered security vulnerabilities. Keyboard shortcut: Press 1</div>
                                
                                <button 
                                    class="tab-btn px-4 py-2 text-sm font-medium border-r border-gray-600 text-gray-100 hover:text-white hover:bg-gray-700 transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-inset" 
                                    data-tab="requests"
                                    role="tab"
                                    aria-selected="false"
                                    aria-controls="requestsTab"
                                    id="requests-tab"
                                    aria-describedby="requests-tab-help">
                                    HTTP Requests <span id="requestCount" class="ml-1 px-2 py-0.5 bg-gray-600 text-white text-xs rounded" aria-label="requests count">0</span>
                                </button>
                                <div id="requests-tab-help" class="sr-only">View HTTP requests made during scanning. Keyboard shortcut: Press 2</div>
                                
                                <button 
                                    class="tab-btn px-4 py-2 text-sm font-medium border-r border-gray-600 text-gray-100 hover:text-white hover:bg-gray-700 transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-inset" 
                                    data-tab="evidence"
                                    role="tab"
                                    aria-selected="false"
                                    aria-controls="evidenceTab"
                                    id="evidence-tab"
                                    aria-describedby="evidence-tab-help">
                                    Evidence <span id="evidenceCount" class="ml-1 px-2 py-0.5 bg-gray-600 text-white text-xs rounded" aria-label="evidence count">0</span>
                                </button>
                                <div id="evidence-tab-help" class="sr-only">View collected evidence for vulnerabilities. Keyboard shortcut: Press 3</div>
                                
                                <button 
                                    class="tab-btn px-4 py-2 text-sm font-medium text-gray-100 hover:text-white hover:bg-gray-700 transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-inset" 
                                    data-tab="targets"
                                    role="tab"
                                    aria-selected="false"
                                    aria-controls="targetsTab"
                                    id="targets-tab"
                                    aria-describedby="targets-tab-help">
                                    Target Management
                                </button>
                                <div id="targets-tab-help" class="sr-only">Manage scan targets and view target details. Keyboard shortcut: Press 4</div>
                            </div>
                        </nav>

                        <!-- Tab Content -->
                        <div id="scan-results" class="tab-content flex-1 overflow-hidden bg-black" role="region" aria-label="Scan Results Content">
                            <!-- Vulnerabilities Tab -->
                            <div 
                                id="vulnerabilitiesTab" 
                                class="tab-pane active h-full flex flex-col" 
                                role="tabpanel" 
                                aria-labelledby="vulnerabilities-tab"
                                aria-live="polite">
                                <div class="flex-1 overflow-y-auto">
                                    <div class="vulnerabilities-list p-4">
                                        <h2 class="sr-only">Vulnerability Results List</h2>
                                        <div id="vulnerabilitiesContainer" class="space-y-3" role="list" aria-label="Discovered vulnerabilities">
                                            <div class="text-center text-gray-400 py-8" role="status">
                                                <i class="bi bi-shield-check text-4xl mb-4" aria-hidden="true"></i>
                                                <p>No vulnerabilities found yet. Start a scan to begin testing.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- HTTP Requests Tab -->
                            <div 
                                id="requestsTab" 
                                class="tab-pane h-full flex flex-col hidden" 
                                role="tabpanel" 
                                aria-labelledby="requests-tab"
                                aria-live="polite">
                                <div class="flex-1 overflow-y-auto">
                                    <div class="requests-list p-4">
                                        <h2 class="sr-only">HTTP Requests History</h2>
                                        <div id="requestsContainer" role="list" aria-label="HTTP requests made during scan">
                                            <div class="text-center text-gray-400 py-8" role="status">
                                                <i class="bi bi-arrow-left-right text-4xl mb-4" aria-hidden="true"></i>
                                                <p>HTTP request history will appear here during scanning.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Evidence Tab -->
                            <div 
                                id="evidenceTab" 
                                class="tab-pane h-full flex flex-col hidden" 
                                role="tabpanel" 
                                aria-labelledby="evidence-tab"
                                aria-live="polite">
                                <div class="flex-1 overflow-y-auto">
                                    <div class="evidence-list p-4">
                                        <h2 class="sr-only">Evidence Collection</h2>
                                        <div id="evidenceContainer" role="list" aria-label="Evidence collected for vulnerabilities">
                                            <div class="text-center text-gray-400 py-8" role="status">
                                                <i class="bi bi-camera text-4xl mb-4" aria-hidden="true"></i>
                                                <p>No evidence collected. Evidence will be gathered during vulnerability detection.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Target Management Tab -->
                            <div 
                                id="targetsTab" 
                                class="tab-pane h-full flex flex-col hidden" 
                                role="tabpanel" 
                                aria-labelledby="targets-tab">
                                <div class="flex-1 overflow-y-auto">
                                    <div class="target-management p-4">
                                        <h2 class="text-lg font-semibold mb-2 text-gray-100">Target Registry</h2>
                                        <div id="targetsList" class="space-y-2" role="list" aria-label="Available scan targets">
                                            <!-- Target list will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </section>
            </div>
        `;
    }

    cacheElements() {
        // Status and controls
        this.elements.scanStatusText = document.getElementById('scanStatusText');
        this.elements.targetSelect = document.getElementById('targetSelect');
        this.elements.targetUrlInput = document.getElementById('targetUrlInput');
        this.elements.addTargetBtn = document.getElementById('addTargetBtn');
        this.elements.scanTypeSelect = document.getElementById('scanTypeSelect');
        this.elements.scanToggleBtn = document.getElementById('scanToggleBtn');
        this.elements.exportResultsBtn = document.getElementById('exportResultsBtn');
        
        // Report generation buttons
        this.elements.generateHTMLReportBtn = document.getElementById('generateHTMLReportBtn');
        this.elements.generateCSVReportBtn = document.getElementById('generateCSVReportBtn');
        this.elements.generateAllReportsBtn = document.getElementById('generateAllReportsBtn');
        this.elements.integrateNmapBtn = document.getElementById('integrateNmapBtn');
        
        this.elements.customScanOptions = document.getElementById('customScanOptions');

        // Progress
        this.elements.progressContainer = document.getElementById('progressContainer');
        this.elements.progressBar = document.getElementById('progressBar');
        this.elements.progressText = document.getElementById('progressText');
        this.elements.currentTest = document.getElementById('currentTest');

        // Statistics
        this.elements.totalTargets = document.getElementById('totalTargets');
        this.elements.vulnerableTargets = document.getElementById('vulnerableTargets');
        this.elements.totalVulns = document.getElementById('totalVulns');
        this.elements.highSeverity = document.getElementById('highSeverity');

        // Content containers
        this.elements.vulnerabilitiesContainer = document.getElementById('vulnerabilitiesContainer');
        this.elements.requestsContainer = document.getElementById('requestsContainer');
        this.elements.evidenceContainer = document.getElementById('evidenceContainer');
        this.elements.targetsList = document.getElementById('targetsList');

        // Counters
        this.elements.vulnCount = document.getElementById('vulnCount');
        this.elements.requestCount = document.getElementById('requestCount');
        this.elements.evidenceCount = document.getElementById('evidenceCount');

        // Scan options
        this.elements.scanOptions = {
            sqlInjection: document.getElementById('sqlInjectionCheck'),
            xss: document.getElementById('xssCheck'),
            directoryTraversal: document.getElementById('directoryTraversalCheck'),
            authenticationBypass: document.getElementById('authBypassCheck'),
            csrf: document.getElementById('csrfCheck')
        };
    }

    updateScanControls(isScanning) {
        const btn = this.elements.scanToggleBtn;
        const icon = btn.querySelector('i');
        const text = btn.querySelector('.btn-text');
        
        if (isScanning) {
            btn.classList.remove('bg-red-600', 'hover:bg-red-700', 'focus:bg-red-700');
            btn.classList.add('bg-gray-600', 'hover:bg-gray-500', 'focus:bg-gray-500');
            btn.dataset.state = 'scanning';
            btn.setAttribute('aria-pressed', 'true');
            btn.setAttribute('aria-describedby', 'scan-toggle-help');
            icon.className = 'bi bi-stop-fill mr-2';
            text.textContent = 'Stop Vulnerability Scan';
            this.elements.exportResultsBtn.disabled = true;
            this.elements.exportResultsBtn.setAttribute('aria-disabled', 'true');
            
            // Disable report generation buttons during scan
            this.elements.generateHTMLReportBtn.disabled = true;
            this.elements.generateHTMLReportBtn.setAttribute('aria-disabled', 'true');
            this.elements.generateCSVReportBtn.disabled = true;
            this.elements.generateCSVReportBtn.setAttribute('aria-disabled', 'true');
            this.elements.generateAllReportsBtn.disabled = true;
            this.elements.generateAllReportsBtn.setAttribute('aria-disabled', 'true');
            
            // Announce scan start to screen readers
            this.announceToScreenReader('Vulnerability scan started', 'assertive');
        } else {
            btn.classList.remove('bg-gray-600', 'hover:bg-gray-500', 'focus:bg-gray-500');
            btn.classList.add('bg-red-600', 'hover:bg-red-700', 'focus:bg-red-700');
            btn.dataset.state = 'ready';
            btn.setAttribute('aria-pressed', 'false');
            icon.className = 'bi bi-play-fill mr-2';
            text.textContent = 'Start Vulnerability Scan';
            this.elements.exportResultsBtn.disabled = false;
            this.elements.exportResultsBtn.setAttribute('aria-disabled', 'false');
            
            // Enable report generation buttons after scan completion
            this.elements.generateHTMLReportBtn.disabled = false;
            this.elements.generateHTMLReportBtn.setAttribute('aria-disabled', 'false');
            this.elements.generateCSVReportBtn.disabled = false;
            this.elements.generateCSVReportBtn.setAttribute('aria-disabled', 'false');
            this.elements.generateAllReportsBtn.disabled = false;
            this.elements.generateAllReportsBtn.setAttribute('aria-disabled', 'false');
        }
        
        this.elements.scanStatusText.textContent = isScanning ? 'Scanning...' : 'Ready';
        this.elements.scanStatusText.className = isScanning ? 'text-yellow-400' : 'text-blue-400';
        
        // Update status for screen readers
        const statusText = isScanning ? 'Currently scanning for vulnerabilities' : 'Ready to start vulnerability scan';
        this.elements.scanStatusText.setAttribute('aria-label', statusText);
    }

    showProgress() {
        this.elements.progressContainer.classList.remove('hidden');
        this.updateProgress(0);
    }

    hideProgress() {
        this.elements.progressContainer.classList.add('hidden');
    }

    updateProgress(progress) {
        this.elements.progressBar.style.width = `${progress}%`;
        this.elements.progressText.textContent = `${progress}%`;
    }

    addVulnerabilityToUI(vulnerability) {
        if (this.elements.vulnerabilitiesContainer.querySelector('.text-center')) {
            this.elements.vulnerabilitiesContainer.innerHTML = '';
        }

        const vulnElement = document.createElement('article');
        vulnElement.className = 'vulnerability-card bg-gray-800 border border-gray-600 p-4 rounded hover:bg-gray-700 transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-50 ' + 
            this.getSeverityBorderColor(vulnerability.severity);
        
        vulnElement.setAttribute('role', 'listitem');
        vulnElement.setAttribute('tabindex', '0');
        vulnElement.setAttribute('aria-label', `${vulnerability.severity} severity vulnerability: ${vulnerability.title}`);
        
        vulnElement.innerHTML = `
            <div class="flex justify-between items-start mb-2">
                <h3 class="font-semibold text-white" id="vuln-title-${Date.now()}">${vulnerability.title}</h3>
                <span class="px-2 py-1 text-xs rounded ${this.getSeverityColor(vulnerability.severity)}" 
                      role="status" 
                      aria-label="Severity level">
                    ${vulnerability.severity}
                </span>
            </div>
            <p class="text-sm text-gray-200 mb-2">${vulnerability.description}</p>
            <dl class="text-xs text-gray-300 space-y-1">
                <div><dt class="inline font-medium text-gray-200">Target:</dt> <dd class="inline">${vulnerability.target}</dd></div>
                <div><dt class="inline font-medium text-gray-200">Parameter:</dt> <dd class="inline">${vulnerability.parameter}</dd></div>
                <div><dt class="inline font-medium text-gray-200">CVSS Score:</dt> <dd class="inline">${vulnerability.cvssScore}</dd></div>
                <div><dt class="inline font-medium text-gray-200">Impact:</dt> <dd class="inline">${vulnerability.impact}</dd></div>
                <div><dt class="inline font-medium text-gray-200">Recommendation:</dt> <dd class="inline">${vulnerability.recommendation}</dd></div>
            </dl>
        `;

        // Add keyboard event handlers for accessibility
        vulnElement.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                vulnElement.click();
            }
        });

        this.elements.vulnerabilitiesContainer.appendChild(vulnElement);
        
        // Announce to screen readers
        this.announceToScreenReader(`New vulnerability found: ${vulnerability.severity} severity ${vulnerability.title}`, 'polite');
    }

    addRequestToUI(request) {
        if (this.elements.requestsContainer.querySelector('.text-center')) {
            this.elements.requestsContainer.innerHTML = '';
        }

        const requestElement = document.createElement('article');
        requestElement.className = 'request-card bg-gray-800 border border-gray-600 p-3 rounded mb-2 hover:bg-gray-700 transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-50';
        
        requestElement.setAttribute('role', 'listitem');
        requestElement.setAttribute('tabindex', '0');
        requestElement.setAttribute('aria-label', `HTTP ${request.method} request to ${request.url}`);
        
        requestElement.innerHTML = `
            <div class="flex justify-between items-start mb-2">
                <span class="font-mono text-sm text-blue-400" role="status">${request.method} ${request.url}</span>
                <time class="text-xs text-gray-400" datetime="${new Date(request.timestamp).toISOString()}">
                    ${new Date(request.timestamp).toLocaleTimeString()}
                </time>
            </div>
            <dl class="text-xs text-gray-300">
                <div><dt class="inline font-medium text-gray-200">Test:</dt> <dd class="inline">${request.testName}</dd></div>
                <div><dt class="inline font-medium text-gray-200">Payload:</dt> 
                     <dd class="inline"><code class="bg-gray-900 text-gray-200 px-1 rounded">${request.payload}</code></dd></div>
            </dl>
        `;

        // Add keyboard event handlers for accessibility
        requestElement.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                requestElement.click();
            }
        });

        this.elements.requestsContainer.appendChild(requestElement);
    }

    addEvidenceToUI(evidence) {
        if (this.elements.evidenceContainer.querySelector('.text-center')) {
            this.elements.evidenceContainer.innerHTML = '';
        }

        const evidenceElement = document.createElement('article');
        evidenceElement.className = 'evidence-card bg-gray-800 border border-gray-600 p-3 rounded mb-2 hover:bg-gray-700 transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-50';
        
        evidenceElement.setAttribute('role', 'listitem');
        evidenceElement.setAttribute('tabindex', '0');
        evidenceElement.setAttribute('aria-label', `Evidence: ${evidence.title} of type ${evidence.type}`);
        
        evidenceElement.innerHTML = `
            <div class="flex justify-between items-start mb-2">
                <h3 class="font-medium text-white">${evidence.title}</h3>
                <time class="text-xs text-gray-400" datetime="${new Date(evidence.timestamp).toISOString()}">
                    ${new Date(evidence.timestamp).toLocaleTimeString()}
                </time>
            </div>
            <dl class="text-sm space-y-1">
                <div><dt class="inline font-medium text-gray-200">Type:</dt> <dd class="inline text-gray-300">${evidence.type}</dd></div>
                <div><dt class="inline font-medium text-gray-200">URL:</dt> 
                     <dd class="inline"><code class="text-xs bg-gray-900 text-gray-200 px-1 rounded">${evidence.request.url}</code></dd></div>
                <div><dt class="inline font-medium text-gray-200">Vulnerability ID:</dt> 
                     <dd class="inline"><code class="text-xs bg-gray-900 text-gray-200 px-1 rounded">${evidence.vulnerabilityId}</code></dd></div>
            </dl>
        `;

        // Add keyboard event handlers for accessibility
        evidenceElement.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                evidenceElement.click();
            }
        });

        this.elements.evidenceContainer.appendChild(evidenceElement);
    }

    // Helper method to announce to screen readers
    announceToScreenReader(message, priority = 'polite') {
        const announcements = document.getElementById('announcements');
        const alerts = document.getElementById('alerts');
        
        const targetElement = priority === 'assertive' ? alerts : announcements;
        if (targetElement) {
            // Clear previous message and set new one
            targetElement.textContent = '';
            setTimeout(() => {
                targetElement.textContent = message;
            }, 10);
            
            // Clear after reading
            setTimeout(() => {
                targetElement.textContent = '';
            }, 3000);
        }
    }

    // Update progress with ARIA attributes
    updateProgress(progress) {
        this.elements.progressBar.style.width = `${progress}%`;
        this.elements.progressText.textContent = `${progress}%`;
        
        // Update ARIA attributes
        const progressContainer = this.elements.progressContainer;
        if (progressContainer) {
            progressContainer.setAttribute('aria-valuenow', progress);
            this.elements.progressBar.setAttribute('aria-valuenow', progress);
        }
    }

    updateCounters() {
        const vulnCount = this.elements.vulnerabilitiesContainer.children.length;
        const requestCount = this.elements.requestsContainer.children.length;
        const evidenceCount = this.elements.evidenceContainer.children.length;

        this.elements.vulnCount.textContent = vulnCount;
        this.elements.requestCount.textContent = requestCount;
        this.elements.evidenceCount.textContent = evidenceCount;
    }

    getSeverityColor(severity) {
        // WCAG 2.1 AAA compliant colors with 7:1 contrast ratio
        const colors = {
            'Critical': 'bg-red-200 text-red-900 border border-red-900',
            'High': 'bg-orange-200 text-orange-900 border border-orange-900',
            'Medium': 'bg-yellow-200 text-yellow-900 border border-yellow-900',
            'Low': 'bg-green-200 text-green-900 border border-green-900'
        };
        return colors[severity] || 'bg-gray-200 text-gray-900 border border-gray-900';
    }

    getSeverityBorderColor(severity) {
        // High contrast border colors for WCAG 2.1 AAA compliance
        const colors = {
            'Critical': 'border-l-4 border-l-red-600',
            'High': 'border-l-4 border-l-orange-600',
            'Medium': 'border-l-4 border-l-yellow-600',
            'Low': 'border-l-4 border-l-green-600'
        };
        return colors[severity] || 'border-l-4 border-l-gray-600';
    }

    getCriticalityColor(criticality) {
        // WCAG 2.1 AAA compliant colors with 7:1 contrast ratio
        const colors = {
            'Critical': 'bg-red-200 text-red-900 border border-red-900',
            'High': 'bg-orange-200 text-orange-900 border border-orange-900',
            'Medium': 'bg-yellow-200 text-yellow-900 border border-yellow-900',
            'Low': 'bg-green-200 text-green-900 border border-green-900'
        };
        return colors[criticality] || 'bg-gray-200 text-gray-900 border border-gray-900';
    }
}
