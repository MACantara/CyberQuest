import { BaseDialogue } from '../../base-dialogue.js';

export class Level3MalwareMayhemDialogue extends BaseDialogue {
    constructor(desktop, character = 'instructor') {
        super(desktop, character);
        this.messages = [
            {
                text: "Welcome to Level 3: Malware Mayhem. In this level, you'll be isolating infections and performing digital cleanup during a high-stakes gaming tournament."
            },
            {
                text: "As a cybersecurity analyst, you'll need to quickly identify different types of malware and contain their spread before they compromise the entire system."
            },
            {
                text: "You'll be working with various security tools to detect, analyze, and remove malicious software while minimizing system downtime."
            },
            {
                text: "Pay close attention to system logs, network traffic, and process behavior to identify the malware's entry point and prevent future infections."
            },
            {
                text: "Successfully completing this level will earn you 200 XP in the Threat Detection category. Are you ready to start?"
            }
        ];
    }

    onComplete() {
        localStorage.setItem('cyberquest_level_3_completed', 'true');
        
        if (this.desktop?.levelManager) {
            setTimeout(async () => {
                await this.desktop.levelManager.startLevel(3);
            }, 500);
        }
    }

    getFinalButtonText() {
        return 'Start Simulation';
    }

    static shouldAutoStart(levelId) {
        const currentLevel = localStorage.getItem('cyberquest_current_level');
        const levelStarted = localStorage.getItem(`cyberquest_level_${levelId}_started`);
        return currentLevel === '3' && !levelStarted;
    }

    static markLevelStarted(levelId) {
        localStorage.setItem(`cyberquest_level_${levelId}_started`, 'true');
    }

    static isCompleted() {
        return localStorage.getItem('cyberquest_level_3_completed') === 'true';
    }
}
