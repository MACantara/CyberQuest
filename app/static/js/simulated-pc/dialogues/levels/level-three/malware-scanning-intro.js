import { BaseDialogue } from '../../base-dialogue.js';

export class MalwareScanningIntroDialogue extends BaseDialogue {
    constructor(desktop, character = 'instructor') {
        super(desktop, character);
        this.messages = [
            { text: 'Outstanding work! You\'ve successfully terminated all malicious processes.' },
            { text: 'Next step: we need to perform a deep malware scan to ensure no remnants remain.' },
            { text: 'Open the Malware Scanner application to begin the full system sweep.' }
        ];
    }

    getCharacterName() {
        // Force return the instructor name if dialogue manager isn't working
        if (this.desktop?.dialogueManager) {
            const name = this.desktop.dialogueManager.getCharacterName(this.character);
            console.log(`[MalwareScanningIntro] Character: ${this.character}, Name: ${name}`);
            return name;
        }
        
        // Fallback to hardcoded instructor name
        console.warn('[MalwareScanningIntro] Dialogue manager not available, using fallback');
        return 'Dr. Cipher';
    }

    onComplete() {
        // Mark level-three started
        localStorage.setItem('cyberquest_level_3_scan_started', 'true');

        // Launch the malware scanning app using application launcher
        if (window.applicationLauncher) {
            setTimeout(async () => {
                await window.applicationLauncher.launchForLevel(3, 'malware-scanner', 'Malware Scanner');
            }, 500);
        }
    }

    getFinalButtonText() {
        return 'Launch Scanner';
    }

    static shouldAutoStart() {
        // don't autoâ€“start; only invoked manually after process-kill
        return false;
    }
}
