{% extends "base.html" %}

{% block title %}System Backup - Admin Panel{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 dark:bg-gray-900 py-6">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="bg-white dark:bg-gray-800 shadow rounded-lg mb-6">
            <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <i class="bi bi-shield-check text-blue-600 dark:text-blue-400 text-2xl"></i>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900 dark:text-white">System Backup & Restore</h1>
                            <p class="text-gray-600 dark:text-gray-400">Manage database backups and system recovery</p>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <a href="{{ url_for('admin.backup_schedule') }}" 
                           class="inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                            <i class="bi bi-calendar-event mr-2"></i>
                            Schedule
                        </a>
                        <button onclick="document.getElementById('createBackupForm').submit()" 
                                class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="bi bi-plus-circle mr-2"></i>
                            Create Backup
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-blue-100 dark:bg-blue-900/30">
                        <i class="bi bi-people text-blue-600 dark:text-blue-400 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Total Users</p>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ stats.total_users }}</p>
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-green-100 dark:bg-green-900/30">
                        <i class="bi bi-shield-check text-green-600 dark:text-green-400 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Total Records</p>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ stats.total_users + stats.total_login_attempts + stats.total_verifications + stats.total_contacts }}</p>
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-purple-100 dark:bg-purple-900/30">
                        <i class="bi bi-archive text-purple-600 dark:text-purple-400 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Available Backups</p>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ stats.backup_count }}</p>
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-yellow-100 dark:bg-yellow-900/30">
                        <i class="bi bi-clock text-yellow-600 dark:text-yellow-400 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Last Backup</p>
                        <p class="text-sm font-bold text-gray-900 dark:text-white">
                            {% if stats.last_backup %}
                                {{ stats.last_backup.strftime('%Y-%m-%d %H:%M') }}
                            {% else %}
                                Never
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Backup Actions -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Create Backup -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Create New Backup</h3>
                </div>
                <div class="p-6">
                    <form id="createBackupForm" method="POST" action="{{ url_for('admin.create_backup') }}">
                        <input type="hidden" id="csrf_token" name="csrf_token" value="{{csrf_token()}}">
                        <p class="text-gray-600 dark:text-gray-400 mb-4">
                            Create a complete backup of all system data including users, login attempts, email verifications, and contact submissions.
                        </p>
                        <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-4">
                            <div class="flex items-start">
                                <i class="bi bi-exclamation-triangle text-yellow-600 dark:text-yellow-400 text-lg mt-0.5 mr-3"></i>
                                <div>
                                    <p class="text-sm text-yellow-800 dark:text-yellow-200 font-medium">Important Notes:</p>
                                    <ul class="text-sm text-yellow-700 dark:text-yellow-300 mt-1 space-y-1">
                                        <li>• Backup process may take several minutes for large databases</li>
                                        <li>• Sensitive data like passwords are included (encrypted)</li>
                                        <li>• Store backups securely and limit access</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <button type="submit" 
                                class="w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
                            <i class="bi bi-download mr-2"></i>
                            Create Full Backup
                        </button>
                    </form>
                </div>
            </div>

            <!-- Restore Backup -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Restore from Backup</h3>
                </div>
                <div class="p-6">
                    <form method="POST" action="{{ url_for('admin.restore_backup') }}" enctype="multipart/form-data">
                        <input type="hidden" id="csrf_token" name="csrf_token" value="{{csrf_token()}}">
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Select Backup File
                            </label>
                            <input type="file" name="backup_file" accept=".zip" required
                                   class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Restore Type
                            </label>
                            <select name="restore_type" id="restore_type" 
                                    onchange="updateRestoreWarning()"
                                    class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                <option value="merge">Merge with existing data (Recommended)</option>
                                <option value="replace">Replace all data (DANGEROUS - Deletes everything)</option>
                            </select>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1" id="restore_description">
                                Merge mode will update existing records and add new ones without deleting current data.
                            </p>
                        </div>

                        <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-4" id="warning_box">
                            <div class="flex items-start">
                                <i class="bi bi-exclamation-triangle-fill text-red-600 dark:text-red-400 text-lg mt-0.5 mr-3"></i>
                                <div>
                                    <p class="text-sm text-red-800 dark:text-red-200 font-medium">CAUTION:</p>
                                    <ul class="text-sm text-red-700 dark:text-red-300 mt-1 space-y-1" id="warning_list">
                                        <li>• Always create a backup before restoring</li>
                                        <li>• Test restore process on development environment first</li>
                                        <li>• This action cannot be undone</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <button type="submit" id="restore_submit_btn"
                                class="w-full bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">
                            <i class="bi bi-upload mr-2"></i>
                            <span id="restore_btn_text">Restore from Backup (Merge Mode)</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Existing Backups -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow">
            <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Available Backups</h3>
            </div>
            <div class="overflow-x-auto">
                {% if backups %}
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-900">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                Backup File
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                Created
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                Size & Records
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                Details
                            </th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                        {% for backup in backups %}
                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <i class="bi bi-file-earmark-zip text-blue-600 dark:text-blue-400 mr-3"></i>
                                    <div>
                                        <div class="text-sm font-medium text-gray-900 dark:text-white">
                                            {{ backup.filename }}
                                        </div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400">
                                            {% if backup.metadata.app_version != 'Error' %}
                                                {{ backup.metadata.app_version }}
                                            {% else %}
                                                Legacy Format
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                <div>{{ backup.created_at.strftime('%Y-%m-%d') }}</div>
                                <div class="text-xs">{{ backup.created_at.strftime('%H:%M:%S') }}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                <div class="font-medium">{{ backup.size_formatted }}</div>
                                <div class="text-xs">
                                    {% if backup.metadata.total_records != 'Error' and backup.metadata.total_records != 'Unknown' %}
                                        {{ backup.metadata.total_records }} records
                                    {% else %}
                                        Size only
                                    {% endif %}
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                <div class="text-xs">
                                    {% if backup.metadata.tables_backed_up != 'Error' and backup.metadata.tables_backed_up != 'Unknown' %}
                                        {{ backup.metadata.tables_backed_up }} tables
                                    {% else %}
                                        Unknown structure
                                    {% endif %}
                                </div>
                                <div class="text-xs">
                                    {% if backup.metadata.database_type != 'Error' and backup.metadata.database_type != 'Unknown' %}
                                        {{ backup.metadata.database_type }}
                                    {% else %}
                                        Legacy
                                    {% endif %}
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                                <div class="flex flex-col space-y-1">
                                    <!-- Download Button -->
                                    <a href="{{ url_for('admin.download_backup', filename=backup.filename) }}" 
                                       class="inline-flex items-center px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">
                                        <i class="bi bi-download mr-1"></i>
                                        Download
                                    </a>
                                    
                                    <!-- Restore Button -->
                                    <button class="restore-backup-btn inline-flex items-center px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 transition-colors"
                                            data-filename="{{ backup.filename }}"
                                            data-records="{{ backup.metadata.total_records }}"
                                            data-created="{{ backup.created_at.strftime('%Y-%m-%d %H:%M') }}">
                                        <i class="bi bi-arrow-clockwise mr-1"></i>
                                        Restore
                                    </button>
                                    
                                    <!-- Delete Button -->
                                    <form method="POST" action="{{ url_for('admin.delete_backup', filename=backup.filename) }}" 
                                          class="inline" onsubmit="return confirm('Are you sure you want to delete this backup?')">
                                        <input type="hidden" id="csrf_token" name="csrf_token" value="{{csrf_token()}}">
                                        <button type="submit" 
                                                class="inline-flex items-center px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-colors w-full">
                                            <i class="bi bi-trash mr-1"></i>
                                            Delete
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="p-8 text-center">
                    <i class="bi bi-archive text-gray-400 text-4xl mb-4"></i>
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">No Backups Available</h3>
                    <p class="text-gray-500 dark:text-gray-400 mb-4">Create your first backup to ensure data safety.</p>
                    <button onclick="document.getElementById('createBackupForm').submit()" 
                            class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                        Create First Backup
                    </button>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Restore Modal -->
<div id="restoreModal" class="fixed inset-0 bg-gray-600/50 overflow-y-auto h-full w-full hidden" style="z-index: 1000;">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800">
        <div class="mt-3">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 dark:bg-blue-900/30">
                <i class="bi bi-arrow-clockwise text-blue-600 dark:text-blue-400 text-xl"></i>
            </div>
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" id="modalTitle">
                    Restore from Server Backup
                </h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500 dark:text-gray-400" id="modalDescription">
                        <!-- Will be filled by JavaScript -->
                    </p>
                </div>
                
                <!-- Restore Type Selection -->
                <form id="directRestoreForm" method="POST" action="{{ url_for('admin.restore_from_server') }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="backup_filename" id="modalBackupFilename">
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 text-left">
                            Restore Type
                        </label>
                        <select name="restore_type" id="modalRestoreType" 
                                onchange="updateModalWarning()"
                                class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            <option value="merge">Merge with existing data (Recommended)</option>
                            <option value="replace">Replace all data (DANGEROUS)</option>
                        </select>
                    </div>
                    
                    <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3 mb-4" id="modalWarningBox">
                        <div class="flex items-start">
                            <i class="bi bi-exclamation-triangle text-yellow-600 dark:text-yellow-400 text-sm mt-0.5 mr-2"></i>
                            <div>
                                <p class="text-xs text-yellow-800 dark:text-yellow-200 font-medium">CAUTION:</p>
                                <ul class="text-xs text-yellow-700 dark:text-yellow-300 mt-1 space-y-1" id="modalWarningList">
                                    <li>• Always create a backup before restoring</li>
                                    <li>• This action cannot be undone</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="items-center px-4 py-3">
                        <button type="submit" id="modalRestoreBtn"
                                class="px-4 py-2 bg-blue-600 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300">
                            Restore from Server
                        </button>
                        <button type="button" onclick="closeRestoreModal()"
                                class="mt-3 px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-400 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function updateRestoreWarning() {
    const restoreType = document.getElementById('restore_type').value;
    const warningBox = document.getElementById('warning_box');
    const warningList = document.getElementById('warning_list');
    const description = document.getElementById('restore_description');
    const submitBtn = document.getElementById('restore_submit_btn');
    const btnText = document.getElementById('restore_btn_text');
    
    if (restoreType === 'replace') {
        // Update warning for replace mode
        warningBox.className = 'bg-red-100 dark:bg-red-900/40 border border-red-300 dark:border-red-700 rounded-lg p-4 mb-4';
        warningList.innerHTML = `
            <li>• <strong>DESTRUCTIVE OPERATION:</strong> All existing data will be permanently deleted</li>
            <li>• You may be logged out if your user account is not in the backup</li>
            <li>• Current user sessions may be terminated</li>
            <li>• Always create a backup before proceeding</li>
            <li>• This action cannot be undone</li>
        `;
        description.innerHTML = '<strong class="text-red-600 dark:text-red-400">Replace mode will DELETE ALL existing data and replace it with backup data. You may need to log in again.</strong>';
        btnText.textContent = 'REPLACE ALL DATA (DESTRUCTIVE)';
        submitBtn.className = 'w-full bg-red-700 text-white py-2 px-4 rounded-lg hover:bg-red-800 transition-colors';
    } else {
        // Update warning for merge mode
        warningBox.className = 'bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-4';
        warningList.innerHTML = `
            <li>• Always create a backup before restoring</li>
            <li>• Duplicate records will be updated with backup data</li>
            <li>• New records from backup will be added</li>
            <li>• Existing data not in backup will be preserved</li>
        `;
        description.innerHTML = 'Merge mode will update existing records and add new ones without deleting current data.';
        btnText.textContent = 'Restore from Backup (Merge Mode)';
        submitBtn.className = 'w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors';
    }
}

// Enhanced form submission with specific confirmation messages
document.addEventListener('DOMContentLoaded', function() {
    const restoreForm = document.querySelector('form[action*="restore_backup"]');
    if (restoreForm) {
        restoreForm.addEventListener('submit', function(e) {
            const restoreType = document.getElementById('restore_type').value;
            const fileName = document.querySelector('input[name="backup_file"]').files[0]?.name || 'selected backup';
            
            let confirmMessage;
            if (restoreType === 'replace') {
                confirmMessage = `⚠️ DESTRUCTIVE OPERATION WARNING ⚠️\n\n` +
                                `You are about to PERMANENTLY DELETE all existing data and replace it with: ${fileName}\n\n` +
                                `This will:\n` +
                                `• Delete ALL users, login attempts, contacts, and verifications\n` +
                                `• You may be logged out and need to log in again\n` +
                                `• Terminate current user sessions\n` +
                                `• Cannot be undone\n\n` +
                                `Are you absolutely sure you want to proceed?`;
            } else {
                confirmMessage = `Confirm Backup Restore\n\n` +
                                `You are about to restore data from: ${fileName}\n\n` +
                                `This will merge backup data with existing data:\n` +
                                `• Update existing records with backup versions\n` +
                                `• Add new records from backup\n` +
                                `• Preserve existing data not in backup\n\n` +
                                `Continue with restore?`;
            }
            
            if (!confirm(confirmMessage)) {
                e.preventDefault();
            }
        });
    }
    
    // Initialize warning on page load
    updateRestoreWarning();
    
    // Add event listeners for restore buttons
    document.querySelectorAll('.restore-backup-btn').forEach(button => {
        button.addEventListener('click', function() {
            const filename = this.dataset.filename;
            const records = this.dataset.records;
            const created = this.dataset.created;
            showRestoreModal(filename, records, created);
        });
    });
});

function showRestoreModal(filename, records, created) {
    const modal = document.getElementById('restoreModal');
    const modalDescription = document.getElementById('modalDescription');
    const modalBackupFilename = document.getElementById('modalBackupFilename');
    
    // Set the hidden form field
    modalBackupFilename.value = filename;
    
    // Update modal content
    modalDescription.innerHTML = `
        <strong>Backup File:</strong> ${filename}<br>
        <strong>Created:</strong> ${created}<br>
        <strong>Records:</strong> ${records !== 'Error' && records !== 'Unknown' ? records + ' records' : 'Unknown'}<br><br>
        Choose how to restore this backup:
    `;
    
    // Reset to merge mode
    document.getElementById('modalRestoreType').value = 'merge';
    updateModalWarning();
    
    // Show modal
    modal.classList.remove('hidden');
}

function closeRestoreModal() {
    const modal = document.getElementById('restoreModal');
    modal.classList.add('hidden');
}

function updateModalWarning() {
    const restoreType = document.getElementById('modalRestoreType').value;
    const warningBox = document.getElementById('modalWarningBox');
    const warningList = document.getElementById('modalWarningList');
    const restoreBtn = document.getElementById('modalRestoreBtn');
    
    if (restoreType === 'replace') {
        // Update warning for replace mode
        warningBox.className = 'bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3 mb-4';
        warningList.innerHTML = `
            <li>• <strong>DESTRUCTIVE:</strong> All existing data will be deleted</li>
            <li>• You may be logged out during restore</li>
            <li>• This action cannot be undone</li>
        `;
        restoreBtn.textContent = 'REPLACE ALL DATA (DESTRUCTIVE)';
        restoreBtn.className = 'px-4 py-2 bg-red-600 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-300';
    } else {
        // Update warning for merge mode
        warningBox.className = 'bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3 mb-4';
        warningList.innerHTML = `
            <li>• Always create a backup before restoring</li>
            <li>• Existing data will be preserved and updated</li>
            <li>• This action cannot be undone</li>
        `;
        restoreBtn.textContent = 'Restore from Server (Merge)';
        restoreBtn.className = 'px-4 py-2 bg-blue-600 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300';
    }
}

// Enhanced form submission with confirmation for direct restore
document.addEventListener('DOMContentLoaded', function() {
    const directRestoreForm = document.getElementById('directRestoreForm');
    if (directRestoreForm) {
        directRestoreForm.addEventListener('submit', function(e) {
            const restoreType = document.getElementById('modalRestoreType').value;
            const filename = document.getElementById('modalBackupFilename').value;
            
            let confirmMessage;
            if (restoreType === 'replace') {
                confirmMessage = `⚠️ DESTRUCTIVE OPERATION WARNING ⚠️\n\n` +
                                `You are about to PERMANENTLY DELETE all existing data and replace it with:\n${filename}\n\n` +
                                `This will:\n` +
                                `• Delete ALL current data in the database\n` +
                                `• You may be logged out and need to log in again\n` +
                                `• Cannot be undone\n\n` +
                                `Are you absolutely sure you want to proceed?`;
            } else {
                confirmMessage = `Confirm Server Restore\n\n` +
                                `You are about to restore data from server backup:\n${filename}\n\n` +
                                `This will merge backup data with existing data:\n` +
                                `• Update existing records with backup versions\n` +
                                `• Add new records from backup\n` +
                                `• Preserve existing data not in backup\n\n` +
                                `Continue with restore?`;
            }
            
            if (!confirm(confirmMessage)) {
                e.preventDefault();
            }
        });
    }
});
</script>

{% endblock %}
